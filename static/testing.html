<!DOCTYPE html>
<html>
<head>
  <title>PCB Auto Compare - JS</title>
</head>
<body>
  <h1>Upload PCB Image for Auto Compare</h1>
  <form id="compareForm">
    <input type="file" id="imgInput" name="img" accept="image/*" required><br><br>
    <button type="submit">Compare Automatically</button>
  </form>

  <div id="result" style="margin-top: 30px;"></div>

  <script>
    document.getElementById("compareForm").onsubmit = async function (e) {
      e.preventDefault();

      const formData = new FormData();
      const imgFile = document.getElementById("imgInput").files[0];
      formData.append("img", imgFile);

      const response = await fetch("/compare_auto", {
        method: "POST",
        body: formData,
      });

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (!response.ok) {
        const error = await response.json();
        resultDiv.innerHTML = `<p style="color:red;">Error: ${error.error}</p>`;
        return;
      }

      const data = await response.json();
      const image = document.createElement("img");
      image.src = `data:image/jpeg;base64,${data.marked_image}`;
      image.style.maxWidth = "600px";

      resultDiv.innerHTML = `
        <p>Matched Standard Image: <strong>${data.matched_standard}</strong></p>
        <p>Similarity Score: <strong>${data.score.toFixed(4)}</strong></p>
      `;
      resultDiv.appendChild(image);
    };
  </script>
</body>
</html>
